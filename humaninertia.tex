% Template for PLoS
% Version 1.0 January 2009
%
% To compile to pdf, run:
% latex plos.template
% bibtex plos.template
% latex plos.template
% latex plos.template
% dvipdf plos.template

\documentclass[10pt]{article}

% amsmath package, useful for mathematical formulas
\usepackage{amsmath}
% amssymb package, useful for mathematical symbols
\usepackage{amssymb}

% graphicx package, useful for including eps and pdf graphics
% include graphics with the command \includegraphics
\usepackage{graphicx}

% cite package, to clean up citations in the main text. Do not remove.
\usepackage{cite}

\usepackage{color}

\usepackage{hyperref}

% Using this to allow for \verb++ declarations in captions.
\usepackage{cprotect}

% TODO temporary
\usepackage{todonotes}

% Use doublespacing - comment out for single spacing
%\usepackage{setspace}
%\doublespacing

% Text layout
\topmargin 0.0cm
\oddsidemargin 0.5cm
\evensidemargin 0.5cm
\textwidth 16cm
\textheight 21cm

% Bold the 'Figure #' in the caption and separate it with a period
% Captions will be left justified
\usepackage[labelfont=bf,labelsep=period,justification=raggedright]{caption}

% Use the PLoS provided bibtex style
\bibliographystyle{plos2009}

% Remove brackets from numbering in List of References
\makeatletter
\renewcommand{\@biblabel}[1]{\quad#1.}
\makeatother

% Leave date blank
\date{}

\pagestyle{myheadings}
%% ** EDIT HERE **


%% ** EDIT HERE **
%% PLEASE INCLUDE ALL MACROS BELOW

%% END MACROS SECTION

\begin{document}

% Title must be 150 characters or less
\begin{flushleft}
{\Large
\textbf{Object oriented implementation the Yeadon human inertial model}
}
% Insert Author names, affiliations and corresponding author email.
\\
Christopher Dembia$^{1,\ast}$,
Jason K. Moore$^{2}$,
Mont Hubbard$^{3}$
\\
\bf{1} Mechanical Engineering, Stanford University, Palo Alto, California, USA
\\
\bf{2} Mechanical Engineering, Cleveland State University, Cleveland, Ohio, USA
\\
\bf{3} Mechanical and Aerospace Engineering, University of California, Davis, California, USA
\\
$\ast$ E-mail: Corresponding cld72@cornell.edu
\end{flushleft}

% Please keep the abstract between 250 and 300 words
\section*{Abstract}
Herein we present an open source software implementation of a popular
mathematical method developed by M.R. Yeadon for estimating the body segment
parameters of a human body~\cite{Yeadon1990f}. The software is written in a
high level open source language and provides three interfaces for manipulating
the data and the model: a Python API, a command-line user interface, and a
graphical user interface. Thus the software can fit into various data
processing pipelines and only requires the standard geometrical measures as an
input.

\section*{Introduction}
For dynamic analyses, it is typical to treat the human body as a collection of
linked rigid bodies. For accurate simulation and analysis, the inertial
properties (mass, center of mass, and moment of inertia) of each of the body
segments must be estimated. Human mass, center of mass, and inertial properties
have
been measured and estimated in a number of ways. Bjornstrup
\cite{Bjornstrup1995} gives a detailed overview of mostly invasive methods up
to 1995. Many other methods exist, including cadaver measurements
(\cite{Dempster1955}, \cite{Clauser1969}, \cite{Chandler1975}), photogrammetry,
ray scanning techniques (\cite{Zatsiorsky1983}, \cite{Zatsiorsky1990}), water
displacement (\cite{Park1999}), rotating platforms (\cite{Griffiths2005}), and
geometrical estimation of the body segments (\cite{Yeadon1990c}).

Yeadon's mathematical method is quite attractive as it requires only a set of
simple geometric measurements from a human and provides reasonably accurate
estimates of the individual human's body segment parameters with simple,
straightforward computations. Yeadon himself developed a Fortran program called
ISEG for his doctoral work \cite{Yeadon1984a} to efficiently compute his
inertia model. The original source code is available in his dissertation but is
not adaptable for inclusion in modern software packages, is not
copyrighted under a liberal reuse license~\footnote{Creative Commons
Attribution-NonCommercial-NoDerivs 2.5}, and it is not very user friendly.

Because we make use of Yeadon's model often in our research, we developed a
modern object oriented program under a permissive license that allows for easy
inclusion into other software packages and includes a graphical user interface
for ease of use.

\section*{Yeadon's model}

In 1990 Yeadon published a four-paper series based on his dissertation work
about simulating human aerial movement, particularly twisting somersaults. His
first paper \cite{Yeadon1990c} describes a method for obtaining joint angles
from film data, and accordingly delves into how he defines the orientation of
the whole body and the relative orientation of parts of the body. His second
paper \cite{Yeadon1990f} describes in detail the geometry of his human model.
He leaves the description of the model's configuration to his third paper
\cite{Yeadon1990e}, which also details the analytical calculation of the
model's angular momentum. The last paper in the series \cite{Yeadon1990d}
compares the trajectory of an aerial flight between a film recording and a
computer simulation using the model developed in the first three papers.

Yeadon provides a lucid explanation of his human inertia model in the series
described above. In this section, we merely seek to summarize his work. Note
that we are not concerned with the angular momentum of the model; we are solely
interested in the model's inertial properties.

The model is defined in terms of \emph{segments}, \emph{levels}, and
\emph{solids}. These three elements of the model are all shown in Figure
\ref{fig:meas}.

\begin{description}
  \item[Segments]
    The human is composed of eleven segments. Each of the four limbs are
    composed of two segments, and the remainder of the body is composed of
    three segments. Each of these segments are rigid bodies, and have at least
    one rotational degree of freedom with respect to the segment to which they
    are attached. The segments are labeled as \textbf{C}, \textbf{A1}, and so
    forth.
  \item[Levels]
    Each segment is defined by a series of transverse cross sections that are
    all parallel with each other.  These cross sections are referred to as
    levels, both in Yeadon's work and in ours. The model contains a total of 45
    levels. Levels are labeled as \textbf{Ls0}, \textbf{La0}, and so forth.
    Each level is in the shape of a \emph{stadium} (see Figure
    \ref{fig:stadium}). There are a number of exceptions in which the stadium
    degenerates into a circle. We can define a stadium by any two of the
    following five attributes: its perimeter $p$, radius $r$, thickness $t$,
    width $w$, and depth $d$. The choice of which two attributes are used to
    define a given stadium depends on the stadium's location in the body, as,
    for example, it is difficult to measure a perimeter about the shoulders
    (\textbf{Ls4}) so a depth is used instead.
  \item[Solids]
    The inertial properties of each segment are computed by viewing each
    segment as a solid lofted through all the levels in the segment. This
    defines $N-1$ solids in a segment defined by $N$ levels. The solids are
    labeled as \textbf{s0}, \textbf{a0}, and so forth. All solids in a segment
    share the same longitudinal axis. A given solid is defined by its two
    bounding stadia and the longitudinal distance between them (the solid's
    height). These stadium-bounded solids are termed \emph{stadium solids}. The
    only exception is \textbf{s7}, the solid above the ear, which is a
    semi-ellipsoid. The model contains a total of 40 solids. Note that in this
    formulation we start numbering the segments from 0, while Yeadon starts
    numbering the solids from 1~\footnote{This is simply to match the Python
    0-based indexing patterns.}.
\end{description}

A key feature of this inertia model is that it can be personalized to a given
individual (subject specific). The model is personalized via 95
anthropometric measurements. These measurements serve to define each stadium,
and to provide the distance between the stadia (the heights of the stadium
solids).

Also, much of the utility of the model comes from being able to specify the
configuration of the human in which one desires its inertial properties. The
configuration is specified via 21 joint angles between the various segments,
all of which are described in Figure \ref{fig:config}.

Thus, Yeadon's model is defined via segments, levels, solids, and configuration
angles. One can personalize the model to an individual via measurements, and
obtain inertial parameters for a desired configuration of the model. The only
additional data that we need to provide to the model are the densities of the
solids. We use Dempster's segmental density values \cite{Dempster1955} by
default, as does Yeadon~\footnote{The user has the option to set these to
alternate values.}. The model is then completed with the analytical
expressions for a stadium solid's and semiellipsoid's center of mass and
moments of inertia, and the parallel axis theorem to combine the inertial
properties of multiple stadium solids. Yeadon provides these explicit formulae
in \cite{Yeadon1990f}. In the next section, we describe with more detail the
measurements required for the model and the way the configuration is defined.

\section*{Implementation of Yeadon's model}

The previous section makes no departures from Yeadon's work. However, we will
now make some departures that are important for the computational
implementation and that serve to generalize his work. These departures are
summarized at the end of this section.

The experimentalist provides all of the measurements, and
optionally the configuration values, in two human readable YAML~\cite{YAML2014}
formated text files. The details of these inputs follow.

\subsection*{Measurements}

There are four types of measurements: lengths (\textbf{L}), perimeters
(\textbf{p}), widths (\textbf{w}), and depths (\textbf{d}). Measurements are
always tied to a level; for example, the symbol \textbf{La1p} denotes the
perimeter of the \textbf{La1} level.

Although we require the heights of the individual stadium solids, the
experimentalist does not measure these independently. Instead, the
experimentalist measures the longitudinal distance across multiple stadium
solids. For example, the \textbf{Ls2L} measurement is not the distance between
the \textbf{Ls1} and \textbf{Ls2} levels. Instead, \textbf{Ls2L} is measured
from \textbf{Ls0}. To learn the levels from which one measures the various
lengths, see Table \ref{tab:length}.

There are a few exceptions to the general measurement scheme we have described
so far. While most of the lengths are directly measured, some are determined by
other lengths. For example, we set \textbf{La1L} to be half of \textbf{La2L},
and so the experimentalist does not measure \textbf{La1L}. This means, however,
that \textbf{La1p} must be measured halfway down segment \textbf{A1}. This
scenario arises in each limb.

All stadia are oriented mediolaterally except for the heel (levels
\textbf{Lj6} and \textbf{Lk6}). The heel stadia are oriented anteroposteriorly.
Note from Figure \ref{fig:meas} that one measures a depth at these levels
instead of a width. This depth is in fact the width of a stadium rotated
through a right angle.

One can find any other necessary information about exceptions from the
measurement scheme in the notes of Figure \ref{fig:meas}.

Since the densities for the model are provided, we readily provide an estimate
of the human's total mass. However, if the experimentalist measures the mass of
the subject, that mass can be used to proportionally scale the densities
provided in the model so that the model's mass matches the measured mass of the
subject.

\subsection*{Configuration}

In this section we describe, relying heavily on Figure \ref{fig:config}, how we
implement the configuration of Yeadon's model. The joint center of each
segment is located with a black dot: it is always located at the center of the
base stadium of the segment. The black arrows on each segment indicate its
local coordinate frame, whose origin is always at the joint center of the
segment. For each segment, the local $z$-axis is the longitudinal axis of the
segment. The green arrows each represent a degree of freedom, and indicate the
direction and sign of the corresponding joint angle via the right-hand rule.
The configuration variables are named with the names of the two segments at
the joint, and a physiological description of the joint angle. Thus,
\verb+K1K2flexion+ is the right knee flexion angle, and \verb+PK1abduction+ is
the right hip abduction angle (positive for abduction, negative for adduction),
and so forth. The exceptions to this naming convention are \verb+somersalt+,
\verb+tilt+, and \verb+twist+, which specify the orientation of the \textbf{P}
segment with respect to the fixed coordinate frame.

Most joints enable more than one degree of freedom, but only four have all
three rotational degrees of freedom. Since rotations are not commutative, we
must specify the order in which we perform rotations at multi-degree of freedom
joints. Each child segment is rotated relative to its parent segment using
Euler X-Y-Z angles~\footnote{Joints with fewer the three angles still follow
this order.} in a body fixed fashion.

The default configuration is that in which all configuration variables have a
value of zero. In the default configuration, the local coordinate basis vectors
of all segments align with the global coordinate basis vectors. This means that
for each segment, in the default configuration, the local $x$-axis lies in a
coronal plane and the local $y$-axis is directed posteriorly. Furthermore, it
is assumed that in this configuration, the palms of the hands face anteriorly.

We now provide the location of the joint centers in our implementation of
Yeadon's model. Such information is not provided in the papers he published
in 1990. The location of the joint centers of segments \textbf{A1} and
\textbf{B1} are at the most distal points of level \textbf{Ls4} on the
respective side of the body. We can express the locations of the joint centers
for segments \textbf{J1} and \textbf{K1}, respectively denoted as
$\mathbf{p_J}$ and $\mathbf{p_K}$, in the local coordinate frame of the pelvis
\textbf{P}:

\begin{align}
    \mathbf{p_J} &= \frac{1}{2} (t_{Ls0} + r_{Ls0})\mathbf{\hat{i}} \\
    \mathbf{p_K} &= -\frac{1}{2} (t_{Ls0} + r_{Ls0})\mathbf{\hat{i}},
\end{align}
where $\mathbf{\hat{i}}$ is the unit vector along the $x$-axis of the pelvis,
$t_{Ls0}$ is the thickness of the stadium at level \textbf{Ls0} and $r_{Ls0}$
is its radius. This choice is informed by calculations present in the ISEG code
published in \cite{Yeadon1984a}. The location of the joint center in all other
segments is at the center of the last stadium in the preceding segment.

\subsection*{Departures from Yeadon's work}

There are a few ways in which our implementation of the human inertia model
differs from that which Yeadon presented in \cite{Yeadon1990c, Yeadon1990f,
Yeadon1990e, Yeadon1990d}. Some of these differences arise from the fact that
his work was tailored for aerial movement, more specifically for twisting
somersaults. We expect, however, that our implementation of the model can be
used in a more general set of investigations.

\begin{description}
    \item[Symmetry of limbs] Yeadon averages the measurements for the left and
        right limbs so that the model is symmetric. We provide the user with
        the option of imposing this symmetry, but we do not perform the
        averaging by default.
    \item[Acromion stadia] One can see that there are actually two different
        cross sections at the acromion level \textbf{Ls5}: we use the wider one
        for solid \textbf{s4} in the chest and use the thinner one (actually, a
        circle) for solid \textbf{s5} in the head. The perimeter measurement at
        \textbf{Ls5} is used for the bottom of \textbf{s5}. In our
        implementation, the stadium used at the top of \textbf{s4} is
        determined internally by the \textbf{Ls4} stadium by the following
        equations:
        \begin{align}
            r &= 0.57 r_{Ls4} \\
            t &= \frac{1}{2}w_{Ls4} - r
        \end{align}
        where $r$ and $t$ are the radius and thickness for the top stadium of
        \textbf{s4}, respectively, and $r_{Ls4}$ and $w_{Ls4}$ are the radius
        and width of the stadium at level \textbf{Ls4}, respectively.
        This issue is not addressed in Yeadon's 1990 papers, and our
        implementation disagrees with the ISEG code found in Yeadon's
        dissertation (see page 358 line 251) \cite{Yeadon1984a}. The
        justification for doing this is that this is exactly what Yeadon does
        in a more recent version of his code, provided to us in a personal
        communication~\cite{Yeadon2011}.
    \item[Hip joint center stadia in the thigh] The experimentalist makes no
        measurements at the \textbf{Lj0} or \textbf{Lk0} stadia, though these
        stadia must be defined to define solids \textbf{j0} and \textbf{k0}. In
        our implementation, these stadia are circles with the same radius $r$:
        \begin{equation}
            r = \frac{1}{2}\sqrt{r_{Ls0} w_{Ls0}}
        \end{equation}
        where $r_{Ls0}$ and $w_{Ls0}$ are the radius and width of the
        \textbf{Ls0} stadium, respectively. As with the acromion stadia just
        mentioned above, the justification for this is not found in either
        Yeadon's 1990 papers or in his dissertation (see page 361 line 403 in
        \cite{Yeadon1984a}). Again, the justification is that this is what
        Yeadon does in a more recent version of the code he shared with
        us~\cite{Yeadon2011}.
    \item[Relationships between configuration variables] Yeadon enforced
        relationships between certain configuration variables, such as
        symmetric movement of the legs with respect to the pelvis. We impose no
        relationships between the 21 configuration variables.
    \item[Inconsistent measurements] The ratio of a stadium's perimeter to its
        width must be greater than 2 and must be less than $\pi$. If this
        restriction does not hold given the measurements, then we set the
        stadium to be a circle. This scenario is not discussed by Yeadon.
    \item[Degenerate stadia] In the case where stadia have essentially zero
        thickness (a circle), the stadium is degenerate and the equations have
        a zero in the denominator. In this scenario, Yeadon still employs the
        formulae for stadium solids but sets the thickness to be very small
        \cite{Yeadon1990f}.  Instead, we manipulate Yeadon's equations so that
        the approximation is not necessary.
    \item[Joint center of chest-head segment] We locate the joint center
        between the torso \textbf{T} and the chest-head \textbf{C} at the
        center of level \textbf{Ls3}. This is in accordance with Figure 1 of
        \cite{Yeadon1990e}. However, this is a departure from Yeadon's
        dissertation \cite{Yeadon1984a}, in which he places the joint center of
        the chest-head at the midpoint of the shoulder joint centers.
\end{description}

\section*{Software design}

The input to \verb+yeadon+ consists of (1) measurements of a subject, and (2)
the joint configuration of the subject. With these two inputs, one is able to
obtain the inertial properties of the subject.

We implemented the mathematical inertia model using the Python language.
Python was chosen due to its ease of use, wide adoption, its stable
infrastructure for distributing open source software, and its strong scientific
community~\cite{SciPy2014}. Our software is distributed as the \verb+yeadon+
package on the Python Package Index at
\url{http://pypi.python.org/pypi/yeadon/} under the 3 clause BSD
license~\cite{BSD2014} which permits both non-commercial and commercial use.

The \verb+yeadon+ package contains 5 modules: \verb+human+, \verb+segment+,
\verb+solid+, \verb+ui+, and \verb+gui+. The \verb+human+ module contains the
public interface of the package, and the \verb+segment+ and \verb+solid+
modules are used internally to construct objects available in the
\verb+human+ module. The user interacts either directly with the \verb+human+
module, or via the \verb+ui+ or \verb+gui+ modules, both of which are clients
to the \verb+human+ module. The \verb+human+ module contains only the
\verb+Human+ class, the \verb+segment+ module contains only the \verb+Segment+
class, and the \verb+solid+ module contains the \verb+Stadium+, \verb+Solid+,
\verb+StadiumSolid+, and \verb+Semiellipsoid+ classes. The package relies
heavily on composition. The \verb+Human+ constructor constructs all
\verb+Stadium+'s, \verb+Solid+'s, and \verb+Segment+'s, and ties together these
objects appropriately. A visual description of the class hierarchy is shown in
the UML diagram in Figure \ref{fig:umldiagram}.

The GUI is built using Mayavi~\cite{Ramachandran2011} which is both a high
level Python interface to the Visualization Tool Kit~\cite{Schroeder2006} and
a lightweight application framework. We utilized Mayavi's ability to rapidly
create cross platform graphical interfaces to expose the underlying
\verb+yeadon+ classes through interactive widgets. The graphical user
interface, shown in Figure \ref{fig:gui}, allows the user to load measurement
data files, adjust configuration variables interactively, view the human body's
mass center location, visualize its inertia ellipsoid, and view the resulting
whole-body inertial properties.

The primary outputs of the software include:

\begin{itemize}
  \item Whole-body inertial properties of the model in any given configuration
      with respect to any point and reference frame.
  \item The segment-fixed inertial properties for any single solid or any
    combination of solids.
  \item Visual depiction of the model in a given configuration. These can be
    exported to bitmap files.
\end{itemize}

The software provides inertial properties (mass, center of mass, and moments of
inertia) for the whole human, for an individual segment, for an individual
solid, or for any combination of segments and solids. In the first case of the
whole human, we provide the center of mass and moments of inertia in the global
fixed coordinate frame. This frame has its origin at the bottom middle of solid
\textbf{s0}, and is aligned with the local frame of segment \textbf{P} when
\verb+somersalt+, \verb+tilt+, and \verb+twist+ are zero. In the case of
individual segments or solids, we can provide the inertial properties in either
the local frame of the segment in inquiry, or in the global fixed frame. We
provide the inertial properties for any other combination in terms of the
global fixed frame.

\section*{Usage}
\label{sec:usage}

We begin our description of how one uses \verb+yeadon+ with an example of an
ice skater performing a spin. As is commonly taught in high school physics, an
ice skater can change their angular momentum by altering their moment of
inertia. By what factor can an ice skater increase his angular velocity
by bringing his arms in? The following commands perform this calculation.

\begin{verbatim}
>>> import yeadon
>>> pi = 3.14159
>>> # Load a prepared measurements file.
>>> h = yeadon.Human('male1.txt')
>>> # Create a 3D rendering of the model.
>>> h.draw()
>>> # Print the moment inertia about the global Z axis.
>>> print('Arms down: {:.2f} kg-m^2'.format(h.inertia[2, 2])
Arms down: 0.55 kg-m^2
>>> # Set the configuration of the shoulder angle.
>>> h.set_CFG('CA1adduction', -0.5 * pi)
>>> h.set_CFG('CB1abduction', 0.5 * pi)
>>> # Print the updated moment inertia about the global Z axis.
>>> print('Arms out: {:.2f} kg-m^2'.format(h.inertia[2, 2]))
Arms out: 1.58 kg-m^2
\end{verbatim}

Figure \ref{fig:iceskater} shows a rendering of the subject with his arms out.
The subject represented by the measurements in \verb+male1.txt+ can increase
their angular velocity (about the vertical axis) by a factor of 2.9 by bringing
his arms in toward his body from an extended position. We can also obtain the
mass and center of mass of the whole Human:

\begin{verbatim}
>>> h.mass
58.200488588422544
>>> h.center_of_mass
array([[ -9.53791842e-19],
       [  0.00000000e+00],
       [  3.77172308e-02]])
\end{verbatim}

If we have a measurement of the subject's actual mass, we can scale all the
segmental densities so that \verb+h.mass+ is the same as our
experimentally-measured mass:

\begin{verbatim}
>>> # Print the mass of the left leg.
>>> h.K1.mass
8.5047753220376521
>>> # Scale the density values based on the measured mass.
>>> h.scale_human_by_mass(60.0)
>>> # The overall mass is updated.
>>> h.mass
60.0
>>> # A slight increase in the segment mass can be seen.
>>> h.K1.mass
8.767736005291324
\end{verbatim}

It is also possible to obtain the combined inertia properties of various
segments and/or solids. For example, we can obtain the mass, center of mass,
and inertia tensor of the entire right arm via:

\begin{verbatim}
>>> # Generate the mass, center of mass, and inertia tensor for the right arm.
>>> h.combine_inertia(['B1', 'B2'])
Combining segments/solids ['B1', 'B2'].
(2.8193675676892624,
 array([[-0.1515    ],
        [ 0.        ],
        [ 0.19831659]]),
 matrix([[ 0.09098096,  0.        ,  0.        ],
         [ 0.        ,  0.09110269,  0.        ],
         [ 0.        ,  0.        ,  0.00194811]]))
\end{verbatim}

All of the methods have rich docstrings which can be accessed via the Python
\verb+help()+ function. For example the previous method's docstring shows us
what the three returned values are:

\begin{verbatim}
>>> help(h.combine_inertia)
Returns the inertia properties of a combination of solids
and/or segments of the human, using the fixed human frame (or the
modified fixed frame as given by the user). Be careful with inputs:
do not specify a solid that is part of a segment that you have also
specified. This method does not assign anything to any object
attributes (it is 'const'), it simply returns the desired quantities.

See documentation for description of the global frame.

Parameters
----------
objlist : tuple
    Tuple of strings that identify a solid or segment. The
    strings can be any of the following:

    * solids: 's0' through 's7', 'a0' through 'a6', 'b0' through 'b6',
      'j0' through 'j8', 'k0' through 'k8'
    * segments: 'P', 'T', 'C', 'A1', 'A2', 'B1', 'B2', 'J1', 'J2',
      'K1', 'K2'

Returns
-------
combined_mass : float
    Sum of the masses of the input solids and/or segments.
combined_COM : np.array (3,1)
    Position of the center of mass of the input solids and/or segments,
    expressed in the global frame .
combined_inertia : np.matrix (3,3)
    Inertia tensor about the combined_COM, expressed in the global frame.
\end{verbatim}
Furthermore, online documentation that includes both prose-style documentation
and the API docstrings is included with the source code and can also be viewed
at \url{http://yeadon.readthedocs.org}.

\section*{Advanced Example}
\label{sec:advanced-example}

We originally developed this software as part of an effort to easily compute
the inertial properties of a human rider seated on a bicycle. A common way to
model the dynamics of a bicycle and rider is to assume that the rider is rigid
and affixed to the rear frame of the bicycle~\cite{Meijaard2007a}. Our
studies~\cite{Moore2012} included a variety of bicycles and riders, where
various combinations of the inertial properties of the bicycle rear frame and
rider were required.

For an advanced example, we will configure the Yeadon model using the
\verb+yeadon+ software such that the human model will be seated on the bicycle, feet at the
bottom bracket axis, hands on the handlebars and arms hanging down. The inertia
of the human will be computed with respect to their center of mass and combined
with that of the rear frame of the bicycle using the parallel axis thereom to
give the total inertia of the human rigidly affixed to the bicycle rear frame
in the bicycle's reference frame.

We use the definition and the parameters of the benchmark bicycle model,
\cite{Meijaard2007a} which is defined with the standard SAE coordinate system
for vehicles. This coordinate system does not correspond with Yeadon's
coordinate system.In addition to the geometrical parameters in the benchmark
bicycle, the rear frame of the bicycle and the location of the handlebars is
defined by several geometric and inertial parameters.  Furthermore, a single
measurement of the rider's forward lean angle relative to the bicycle frame was
taken.

An interactive IPython~\cite{Perez2007} notebook in the supplementary materials
provides a detailed walkthrough of the advanced usage example. The following
only briefly summarizes the steps involved in the computation and how the
\verb+yeadon+ software is used.

\begin{enumerate}
  \item The geometric and inertial properties of the bicycle were estimated
    with an independent method~\cite{Moore2012}. The inertial properties of the
    rear frame of the bicycle were expressed in the SAE coordinate system
    described above.
  \item A subset of the geometry of the bicycle and rider which locates the
    bicycle rider interface points relative to the bicycle and human along with
    3D kinematics are used to compute the human's configuration variables which
    enforce the proper seating position for any given bicycle. The SymPy
    Mechanics package~\cite{Gede2013} is used for these computations.
  \item The \verb+Human.inertia_transformed+ method is used to express the
    human's inertia in the bicycle's reference frame.
  \item The combined mass and center of mass of the human and the rear frame of
    the bicycle are computed and the parallel axis thereom is employed to
    express the inertia of each body about the combined center of mass, where
    they are then summed to get the combined inertia.
\end{enumerate}

The example shows how to set a complex configuration of the Yeadon model and
extract the geometric and inertial properties about arbitrary reference frames
and points along with visualizing the configuration. An online view of the
notebook can be found at
\url{http://nbviewer.ipython.org/github/chrisdembia/humaninertiapaper/blob/master/src/bicycle_example.ipynb}.

\section*{Conclusion}
We have presented an open source software package that implements a widely used
inertial model of the human. This package is disseminated and documented and
available in public repositories under a permissive copyright license. The
software provides an API for use as a library, and also has a command-line
user interface and a graphical user interface for interactive high level use as
a standalone application. The structural design of the software is presented as
an introduction to the source code which is available in a public repository
that is open for contributions and modifications. Finally, we provide both
simple and advanced use cases for the API, one in the text of the paper and one
in the supplementary IPython notebook.

\section*{Acknowledgments}
We would like to thank M.R. Yeadon for sharing his source code and measurement
methodologies. His sharing greatly improved the quality of our software.

This material is partially based upon work supported by the National Science
Foundation under Grant No. 0928339. Any opinions, findings, and conclusions or
recommendations expressed in this material are those of the author(s) and do
not necessarily reflect the views of the National Science Foundation.

%\section*{References}
% The bibtex filename
\bibliography{humaninertia}

\section*{Figure Legends}
%\begin{figure}[!ht]
%\begin{center}
%%\includegraphics[width=4in]{figure_name.2.eps}
%\end{center}
%\caption{
%{\bf Bold the first sentence.}  Rest of figure 2  caption.  Caption 
%should be left justified, as specified by the options to the caption 
%package.
%}
%\label{Figure_label}
%\end{figure}

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[height=6in]{figfactory/measurements.pdf}
  \end{center}
  \caption{
    {\bf Measurements required for the human inertia model.}  The human is
    defined in terms of segments, levels, and solids. Segments are separated by
    alternating colors, and are denoted as \textbf{P}, \textbf{A1}, etc. Levels
    are denoted as ``\textbf{L$<$s$>$\#}'', where \textbf{$<$s$>$} denotes a
    part of the body (e.g. \textbf{j} for the left leg) and \textbf{\#} denotes
    the index of the level in the part of the body. The solid ``above'' level
    \textbf{L$<$s$>$\#} is denoted as ``\textbf{$<$s$>$\#}''. The model is
    personalized via 95 measurements, of which there are 4 types: lengths
    \textbf{L} along the longitudinal axis of the segments, perimeters
    \textbf{p} about the segments, mediolateral widths \textbf{w}, and
    anteroposterior depths \textbf{d}. Black dots denote joint centers
    \cite{Yeadon1990c}.
  }
  \label{fig:meas}
\end{figure}

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=3.27in]{figfactory/stadium/stadium.pdf}
  \end{center}
  \caption{
    {\bf Stadium cross section shape.}  The levels that define the segments are
    all in the shape of a stadium, with one exception. We can define a stadium
    by by any two of its attributes: perimeter $p$, radius $r$, thickness $t$,
    width $w$, and depth $d$.
  }
  \label{fig:stadium}
\end{figure}

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[height=6in]{figfactory/configuration.pdf}
  \end{center}
  \caption{
    {\bf Configuration variables for the human inertia model.}  The
    configuration of the human is defined using 21 joint angles, represented by
    green vectors. A green cross represents a vector into the page, and a green
    circle represents a vector out of the page. The direction of rotation for a
    joint angle is given by the right-hand rule about its vector. The labels
    beside the vectors are the names of the configuration variables in the
    code. The black dot on each segment denotes its joint center. The origin
    of the global fixed coordinate frame is at the bottom center of the pelvis
    segment. The local coordinate frame of each segment is specified by the
    pair of perpendicular black vectors in or next to the segments. Despite the
    locations of these black vectors, the origin of a segment's local
    coordinate system is always at its joint center~\cite{Yeadon1990e}.
  }
  \label{fig:config}
\end{figure}

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=4in]{figfactory/umldiagram/umldiagram.pdf}
  \end{center}
  \cprotect\caption{
    {\bf UML diagram of Yeadon package.}
    The \verb+Human+ class constructs all \verb+Segment+'s, \verb+Solid+'s, and
    \verb+Stadium+'s, and assembles them appropriately. The classes
    \verb+StadiumSolid+ and \verb+Semiellipsoid+ inherit from \verb+Solid+.
    This diagram does not reveal the entire public interface of the classes
    shown. The user interacts with module through the attributes or methods of
    the \verb+Human+ class, or via the \verb+ui+ or \verb+gui+ modules.
  }
  \label{fig:umldiagram}
\end{figure}

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=6in]{figfactory/gui-screenshot.png}
  \end{center}
  \caption{
    {\bf Screenshot of the GUI application.} A screenshot of the Mayavi GUI
    application (QT backend) running on Ubuntu 14.04 is shown. The user can
    supply the path to measurement YAML files to load different subject
    specific users. The graphics window on the left shows a 3D view of the
    model. The viewing angle, camera perspective, and other details can be
    manipulated with a mouse or the from the toolbar above the window. The tabs
    on the right provide sliders and text inputs for all 21 configuration
    variables and allow the user to interactively set the configuration. The
    ``Reset Configuration'' button sets all the configuration variables to
    zero. The mass center and inertia ellipsoid of the entire body can be
    toggled with the checkboxes. Finally, the gross mass, center of mass, and
    inertia tensor are displayed in the bottom right and updated interactively
    as the configuration is altered.
  }
  \label{fig:gui}
\end{figure}

\begin{figure}[!ht]
  \begin{center}
    \includegraphics[width=4in]{figfactory/iceskater.png}
  \end{center}
  \caption{
    {\bf View of the model with the arms extended.} The ice skater can increase
    his rotational moment of inertia by extending his arms.
    This shows the model representation of that pose.
  }
  \label{fig:iceskater}
\end{figure}

\section*{Tables}
%\begin{table}[!ht]
%\caption{
%\bf{Table title}}
%\begin{tabular}{|c|c|c|}
%table information
%\end{tabular}
%\begin{flushleft}Table caption
%\end{flushleft}
%\label{tab:label}
% \end{table}

\begin{table}[!ht]
  \centering
  \caption{
    \bf{Length measurements}
  }
  \begin{tabular}{cc}
    \hline
    \textbf{length for these levels} & \textbf{are measured from this level}\\
    \hline
    Ls1 - Ls5 & Ls0 \\
    Ls6 - Ls8 & Ls5 \\
    La2 - La4 & La0 \\
    La5 - La7 & La4 \\
    Lb2 - Lb4 & Lb0 \\
    Lb5 - Lb7 & Lb4 \\
    Lj1, Lj3 - Lj5 & Lj0 \\
    Lj8 - Lj9 & Lj5  \\
    Lk1, Lk3 - Lk5 & Lk0 \\
    Lk8 - Lk9 & Lk5  \\
  \end{tabular}
  \begin{flushleft}
    The length measurements are not simply the heights of the stadium solids.
    They are defined relative to a certain preceding level in their segment.
  \end{flushleft}
  \label{tab:length}
\end{table}

\end{document}
